<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Xem Tài liệu - Đại hội Đảng bộ Tỉnh</title>
    <link rel="stylesheet" href="/css/style-index.css" />
    <link rel="stylesheet" href="/css/tailieu.css" />
    <link rel="icon" type="image/png" href="/images/Codang.png" />
    <style>
      /* Reset và làm cho trang chiếm toàn bộ chiều cao */
      html,
      body {
        margin: 0;
        padding: 0;
        height: 100%;
      }
      /* Biến container chính thành một cột linh hoạt chiếm toàn bộ chiều cao */
      .portal-container {
        display: flex;
        flex-direction: column;
        height: 100%;
        width: 100%;
      }
      /* Thu gọn phần header */
      .media-header {
        flex-shrink: 0;
        padding: 12px 20px;
        background-color: #f8f9fa;
        border-bottom: 1px solid #dee2e6;
        text-align: center;
      }
      /* THAY ĐỔI 1: Định dạng lại tiêu đề h2 */
      h2#pdf-title {
        margin: 0;
        font-size: 1.2rem;
        color: #0d6efd; /* Chuyển thành màu xanh dương */
        text-transform: uppercase; /* Chuyển thành chữ IN HOA */
      }
      /* Yêu cầu khung xem tài liệu chiếm hết không gian còn lại */
      .pdf-viewer-container {
        flex-grow: 1;
      }
      /* Đảm bảo iframe lấp đầy khung chứa của nó */
      #pdf-embed {
        width: 100%;
        height: 100%;
      }
      /* THAY ĐỔI 2: Ẩn khung chứa nút bấm cũ */
      /* THAY ĐỔI 2: Tạo kiểu mới cho nút bấm, đặt ở góc dưới bên phải */
      .back-button {
        position: fixed;
        bottom: 30px;
        right: 30px;
        z-index: 1000;
        padding: 10px 25px;
        background-color: #dc3545; /* Màu đỏ cho nổi bật */
        color: white;
        border-radius: 20px;
        font-weight: bold;
        text-decoration: none;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      }
    </style>
  </head>
  <body>
    <div class="portal-container">
      <header class="media-header">
        <h2 id="pdf-title">Đang tải tài liệu...</h2>
      </header>

      <main class="pdf-viewer-container">
        <iframe id="pdf-embed" src="" frameborder="0"></iframe>
      </main>

      <div class="back-button-container">
        <a href="tailieu.html" class="back-button"> Quay lại danh sách</a>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const urlParams = new URLSearchParams(window.location.search);
        const fileName = urlParams.get("file");
        const docTitle = urlParams.get("title");
        const pdfTitleElement = document.getElementById("pdf-title");
        const pdfEmbedElement = document.getElementById("pdf-embed");

        if (fileName) {
          // Luôn hiển thị tiêu đề tài liệu
          pdfTitleElement.textContent =
            docTitle || fileName.replace(".pdf", "");

          // ---- MÃ THÔNG MINH BẮT ĐẦU TỪ ĐÂY ----

          // Kiểm tra xem trang web có đang chạy trên máy tính cá nhân (localhost) không
          const isLocal =
            window.location.hostname === "localhost" ||
            window.location.hostname === "127.0.0.1";

          if (isLocal) {
            // --- CHẠY TRÊN MÁY TÍNH ---
            // Dùng cách nhúng trực tiếp, vì trình duyệt trên máy tính xem tốt
            console.log("Đang chạy trên localhost, nhúng PDF trực tiếp.");
            pdfEmbedElement.src = `/Tailieu/${fileName}`;
          } else {
            // --- CHẠY TRÊN MẠNG INTERNET ---
            // Dùng Google Docs Viewer để tương thích với mọi thiết bị, đặc biệt là iPad
            console.log("Đang chạy trên server, dùng Google Docs Viewer.");

            const baseUrl = window.location.origin;
            const fullFileUrl = `${baseUrl}/Tailieu/${fileName}`;
            const googleViewerUrl = `https://docs.google.com/gview?url=${encodeURIComponent(
              fullFileUrl
            )}&embedded=true`;

            pdfEmbedElement.src = googleViewerUrl;
          }
        } else {
          pdfTitleElement.textContent = "Không tìm thấy tài liệu";
        }
      });
    </script>
  </body>
</html>
